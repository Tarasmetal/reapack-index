#!/usr/bin/env ruby

Signal.trap('INT') { abort }

require 'reapack/index'

require 'git'
require 'pp'

git = Git.open ARGV.first || Dir.pwd
db = ReaPack::Index.new File.join(git.dir.to_s, 'index.xml')

commits = nil
if db.commit
  commits = git.log.between db.commit
else
  commits = git.log
end

FILE_TYPES = {
  'lua' => :script,
  'eel' => :script,
}.freeze

commits.reverse_each {|commit|
  commit.diff_parent.each {|diff|
    ext = File.extname(diff.path)[1..-1]
    # next unless FILE_TYPES.has_key? ext

    puts diff.path
    blob = diff.blob(:src)
    puts blob.contents if blob
  }
  puts '*'*80
}
